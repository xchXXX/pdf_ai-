产品使用说明：AI-PDF 电路图搜索系统
1. 产品简介
本系统是一款基于 AI 技术的 PDF 电路图智能处理工具，支持 PDF 电路图上传、自动解析、文字提取、智能搜索及问答功能，帮助用户快速定位电路图中的关键信息（如连接器编号、针脚号、元器件名称等），适用于汽车、电子等领域的电路图分析场景。
2. 核心功能
PDF 上传：支持本地 PDF 文件上传至系统，自动保存至指定目录。
AI 解析：自动对 PDF 进行分页处理，通过 OCR 技术提取文字及位置信息，并缓存解析结果。
智能搜索：基于关键词及同义词扩展，快速定位包含目标信息的 PDF 页面。
AI 问答：结合大模型对搜索到的页面内容进行分析，回答电路图相关问题（如 “导线截面积为 1.5mm² 的导线对应的颜色或备注信息是什么？”）。
3. 使用流程
    一.上传 PDF
通过系统上传接口（或前端页面）上传电路图 PDF 文件，支持单个文件上传，文件格式限 PDF。也可下载全部文件后，将文件放在pdfs文件夹下，初始化时会自动解析。
上传成功后，系统自动初始化文件状态为 “待解析”。
    二.触发解析
上传完成后，系统后台自动启动 PDF 解析流程（或手动触发），解析过程中可实时查看进度（0%-100%）。
解析内容包括：每页文字提取（含位置坐标）、页面类型判断（标题页 / 表格页）、图片压缩优化。
    三.搜索与问答
解析完成后，输入搜索关键词（如 “ECU”“X18”），ai自动扩展同义词（如 “ECU”→“发动机控制器，Engine Control Unit”），返回相关页面。
针对具体问题（如导线截面积为 1.5mm² 的导线对应的颜色或备注信息是什么？），系统结合相关页面图片及文字内容，生成精准回答并标注信息来源页码。
5. 注意事项
上传的 PDF 文件建议清晰可读，模糊或倾斜严重的文件可能影响 OCR 识别精度。
解析大文件（超过 100 页）时可能耗时较长，请耐心等待。
系统依赖百度 OCR 接口和大模型 API，需确保网络通畅及密钥配置正确。
项目架构
1. 整体架构
采用前后端分离的轻量化架构，后端以 API 服务为核心，集成 AI 能力与 PDF 处理工具，前端负责用户交互。
[用户层] → [前端静态页面] → [FastAPI后端服务] → [核心功能模块] → [数据存储层]  
2. 模块划分
模块	功能描述	核心组件 / 代码入口
前端交互层	提供文件上传、进度展示、搜索问答界面，基于静态 HTML/CSS/JS 实现。	static/index.html、static/viewer.html
API 服务层	提供 RESTful API，处理 HTTP 请求（上传、搜索、解析状态查询等）。	FastAPI实例及路由（@app.get/@app.post）
PDF 处理模块	负责 PDF 文件管理（上传、存储、分页）、图片转换及压缩。	pdfplumber、pdf2image、Pillow
AI 识别模块	调用百度 OCR 接口提取 PDF 页面文字及位置信息，支持高精度含坐标识别。	ai_extract_text_with_position函数
大模型交互模块	基于 LangChain 框架调用大模型，实现同义词扩展、实体提取及问答功能。	ChatOpenAI、PromptTemplate
状态与缓存模块	管理 PDF 解析状态（待解析 / 处理中 / 完成 / 失败）及解析结果缓存。	parse_status字典、pdf_cache字典
3. 数据流向
用户上传 PDF → 保存至pdfs目录 → 初始化解析状态。
解析触发后 → 分页转换为图片 → 调用百度 OCR 提取文字及位置 → 压缩图片 → 缓存解析结果。
搜索请求 → 扩展同义词 → 匹配缓存中的页面文字 → 返回相关页面。
问答请求 → 提取问题实体 → 定位相关页面 → 生成带图片的提示词 → 调用大模型返回答案。
技术选型
技术 / 工具	用途	选型原因
FastAPI	后端 API 框架	高性能、支持异步任务、自动生成接口文档，适合快速开发轻量级服务。
pdfplumber	PDF 内容提取与图片转换	支持高精度 PDF 分页处理，可直接将页面转为图片，适配电路图细节提取。
pdf2image	PDF 转图片辅助工具	补充 pdfplumber 的图片转换能力，适配复杂格式 PDF。
Pillow	图像处理（压缩、格式转换）	轻量级图片处理库，支持按尺寸和大小压缩，优化 OCR 识别效率和网络传输速度。
百度 OCR API	文字识别（含位置信息）	高精度含坐标识别能力，支持中英混合文字、倾斜矫正，适合电路图中密集小字提取。
LangChain	大模型应用框架	简化提示词模板、大模型调用及输出解析流程，支持多轮对话和工具链集成。
OpenAI API	大模型交互（同义词扩展、问答）	支持多模态输入（文字 + 图片），适合处理电路图中 “文字 + 图形” 混合信息的问答。
python-dotenv	环境变量管理	安全存储 API 密钥（避免硬编码），便于开发环境与生产环境配置分离。
技术决策
1. 为何选择 “OCR + 大模型” 混合方案？
电路图包含大量非结构化信息（文字、符号、连线），纯 OCR 难以直接理解语义，结合大模型可实现 “提取文字→理解语义→精准问答” 的完整流程。
百度 OCR 提供位置信息，便于后续定位关键文字在页面中的坐标；大模型则弥补 OCR 对复杂语义的理解缺陷（如 “针脚连接关系”）。
2. 为何采用异步解析 PDF？
PDF 解析（尤其是多页文件）涉及图片转换、OCR 调用等耗时操作，通过BackgroundTasks（代码中隐含异步逻辑）避免阻塞 API 主线程，提升用户体验。
3. 图片压缩的必要性？
电路图 PDF 转图片后尺寸较大（300DPI 下可能超过 10MB），压缩至 3.8MB 以下可减少 OCR 接口调用耗时和网络传输成本，同时保证识别精度。
4. 同义词扩展的设计目的？
电路图中同一元器件可能有多种名称（如 “ECU” 与 “发动机控制器”），通过大模型生成同义词列表，可提升搜索召回率，避免因术语差异导致的漏检。
5. 缓存解析结果的考量？
PDF 解析为高成本操作（耗时、耗 API 资源），将结果缓存至内存（pdf_cache）可避免重复解析，显著提升后续搜索和问答的响应速度。
